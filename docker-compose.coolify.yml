# Coolify-specific overrides for docker-compose.yml
# This file overrides the base docker-compose.yml to work better with Coolify
#
# Deploy with: docker compose -f docker-compose.yml -f docker-compose.coolify.yml up -d
#
# Changes:
# - Use standard MinIO image instead of Chainguard (healthcheck compatibility)
# - Expose ports that are localhost-bound in base compose (for Coolify networking)
# - Simplified PostgreSQL configuration
# - Remove Redis maxmemory-policy

services:
  minio:
    image: docker.io/minio/minio:latest
    entrypoint: []
    command: server /data --address ":9000" --console-address ":9001"
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-minio}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-miniosecret}
    ports:
      - 9090:9000
      - 9091:9001  # Not localhost-bound for Coolify
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]
      interval: 5s
      timeout: 5s
      retries: 5
      start_period: 10s
    # Bucket creation is handled by the application on first use

  # Expose ClickHouse ports (commented out in base for security, but needed for Coolify)
  clickhouse:
    ports: []  # Remove localhost-bound ports, services connect internally

  # Expose Redis port and remove maxmemory-policy
  redis:
    command: >
      --requirepass ${REDIS_AUTH:-myredissecret}
    ports: []  # Remove localhost-bound ports, services connect internally

  # Simplify PostgreSQL configuration
  postgres:
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-postgres}
      POSTGRES_DB: postgres
    ports: []  # Remove localhost-bound ports, services connect internally
